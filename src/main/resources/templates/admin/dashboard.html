<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Retro Macros</title>
    <link rel="stylesheet" th:href="@{/css/admin.css}">
    <link rel="stylesheet" th:href="@{/css/theme.css}">
    </head>
<body class="admin">
<div th:if="${session.impersonating}" class="impersonation-banner">
    You are impersonating a user.
    <a href="/admin/exit-impersonation">Exit Impersonation</a>
    </div>
<div class="admin-header">
    <h1>⚡ RETRO MACROS ADMIN</h1>
    <nav class="admin-nav">
        <a href="/admin" class="active">Dashboard</a>
        <a href="/admin/users">Users</a>
        <a href="/admin/meal-plans">Meal Plans</a>
        <a href="/admin/food-logs">Food Logs</a>
        <a href="/admin/ai-accuracy">AI Accuracy</a>
        <a href="/dashboard">← Exit Admin</a>
    </nav>
</div>

<div class="admin-container">
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">Total Users</div>
            <div class="stat-value" th:text="${totalUsers}">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">New This Week</div>
            <div class="stat-value" th:text="${newUsersThisWeek}">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Active Today</div>
            <div class="stat-value" th:text="${activeToday}">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">AI Success Rate</div>
            <div class="stat-value" th:text="${aiSuccessRate} + '%'">0%</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">API Cost</div>
            <div class="stat-value" th:text="'$' + ${estimatedApiCost}">$0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Macro Accuracy</div>
            <div class="stat-value" th:text="${macroAccuracy} + '%'">0%</div>
        </div>
    </div>

    <div class="admin-table-container">
        <h2 style="margin-top:0">Recent Sign-Ups</h2>
        <table class="admin-table">
            <thead><tr><th>Name</th><th>Email</th><th>Signed Up</th><th>Actions</th></tr></thead>
            <tbody>
            <tr th:each="user : ${recentUsers}" onclick="window.location.href='/admin/users/' + [[${user.id}]]">
                <td th:text="${user.name}">User</td>
                <td th:text="${user.email}">user@email</td>
                <td th:text="${user.createdAt}">date</td>
                <td><a th:href="@{/admin/users/{id}(id=${user.id})}" class="btn-admin" onclick="event.stopPropagation()">View</a></td>
            </tr>
            </tbody>
        </table>
    </div>

    <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <a href="/admin/users" class="btn-admin">View All Users</a>
        <a href="/admin/meal-plans" class="btn-admin">View Meal Plans</a>
        <a href="/admin/food-logs" class="btn-admin">View Food Logs</a>
        <a href="/admin/ai-accuracy" class="btn-admin">Check AI Accuracy</a>
        <a href="/admin/export/users" class="btn-admin btn-success">Export Users</a>
    </div>
</div>

</body>
</html>

