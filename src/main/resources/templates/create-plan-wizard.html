<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Your Plan | Retro Macros</title>
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/css/bootstrap.min.css}" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Audiowide&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/theme.css}" />
    <link rel="stylesheet" th:href="@{/css/wizard.css}">
</head>
<body class="neon">
<div th:replace="~{fragments/navbar :: authenticated-navbar}"></div>

    <!-- Wizard Container -->
    <div class="wizard-container container mb-5">
        
        <!-- Progress Indicator -->
        <div class="wizard-progress">
            <div class="step-indicator">
                <div class="step active" data-step="1">
                    <span class="step-number">1</span>
                    <span class="step-label">About You</span>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="2">
                    <span class="step-number">2</span>
                    <span class="step-label">Activity & Goal</span>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="3">
                    <span class="step-number">3</span>
                    <span class="step-label">Advanced</span>
                </div>
            </div>
        </div>

        <!-- Form (maintains existing endpoint) -->
        <form id="createPlanForm" th:action="@{/generate}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            
            <!-- STEP 1: About You -->
            <div class="wizard-step active" data-step="1">
                <h2 class="wizard-title">Step 1 of 3: About You</h2>
                
                <!-- Age -->
                <div class="form-group">
                    <label for="age">How old are you?</label>
                    <input type="number" 
                           id="age" 
                           name="age" 
                           min="13" 
                           max="120" 
                           required 
                           placeholder="Enter your age">
                    <span class="input-suffix">years</span>
                </div>

                <!-- Sex -->
                <div class="form-group">
                    <label>What's your biological sex?</label>
                    <div class="button-group">
                        <button type="button" 
                                class="option-button" 
                                data-value="Male" 
                                onclick="selectSex('Male')">
                            <span class="button-icon">üë®</span>
                            <span class="button-label">MALE</span>
                        </button>
                        <button type="button" 
                                class="option-button" 
                                data-value="Female" 
                                onclick="selectSex('Female')">
                            <span class="button-icon">üë©</span>
                            <span class="button-label">FEMALE</span>
                        </button>
                    </div>
                    <input type="hidden" id="sex" name="sex" required>
                </div>

                <!-- Height -->
                <div class="form-group">
                    <label>How tall are you?</label>
                    <div class="input-group">
                        <input type="number" 
                               id="heightFeet" 
                               name="heightFeet" 
                               min="3" 
                               max="8" 
                               required 
                               placeholder="Feet">
                        <span class="input-separator">ft</span>
                        <input type="number" 
                               id="heightInches" 
                               name="heightInches" 
                               min="0" 
                               max="11" 
                               required 
                               placeholder="Inches">
                        <span class="input-separator">in</span>
                    </div>
                </div>

                <!-- Weight -->
                <div class="form-group">
                    <label for="weight">How much do you weigh?</label>
                    <div class="input-group">
                        <input type="number" 
                               id="weight" 
                               name="weight" 
                               min="50" 
                               max="500" 
                               required 
                               placeholder="Enter weight">
                        <select id="weightUnit" name="weightUnit" class="unit-selector">
                            <option value="lbs" selected>lbs</option>
                            <option value="kg">kg</option>
                        </select>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="wizard-nav">
                    <button type="button" 
                            class="btn-wizard btn-next" 
                            onclick="nextStep(1)">
                        Next Step ‚Üí</button>
                </div>
            </div>

            <!-- STEP 2: Activity & Goal -->
            <div class="wizard-step" data-step="2">
                <h2 class="wizard-title">Step 2 of 3: Activity & Goal</h2>
                
                <!-- Activity Level -->
                <div class="form-group">
                    <label>What's your activity level?</label>
                    <div class="card-group">
                        <div class="option-card" 
                             data-value="sedentary" 
                             onclick="selectActivity('sedentary')">
                            <div class="card-icon">üõãÔ∏è</div>
                            <div class="card-title">SEDENTARY</div>
                            <div class="card-description">Little to no exercise<br>Desk job, minimal movement</div>
                        </div>
                        
                        <div class="option-card" 
                             data-value="lightly_active" 
                             onclick="selectActivity('lightly_active')">
                            <div class="card-icon">üö∂</div>
                            <div class="card-title">LIGHTLY ACTIVE</div>
                            <div class="card-description">Light exercise 1-3 days/week<br>Walking, light cardio</div>
                        </div>
                        
                        <div class="option-card" 
                             data-value="moderately_active" 
                             onclick="selectActivity('moderately_active')">
                            <div class="card-icon">üèÉ</div>
                            <div class="card-title">MODERATELY ACTIVE</div>
                            <div class="card-description">Moderate exercise 3-5 days/week<br>Regular gym sessions</div>
                        </div>
                        
                        <div class="option-card" 
                             data-value="very_active" 
                             onclick="selectActivity('very_active')">
                            <div class="card-icon">üí™</div>
                            <div class="card-title">VERY ACTIVE</div>
                            <div class="card-description">Hard exercise 6-7 days/week<br>Daily intense training</div>
                        </div>
                        
                        <div class="option-card" 
                             data-value="extremely_active" 
                             onclick="selectActivity('extremely_active')">
                            <div class="card-icon">üî•</div>
                            <div class="card-title">EXTREMELY ACTIVE</div>
                            <div class="card-description">Very hard exercise & physical job<br>Athlete-level training</div>
                        </div>
                    </div>
                    <input type="hidden" id="activityLevel" name="activityLevel" required>
                </div>

                <!-- Fitness Goal -->
                <div class="form-group">
                    <label>What's your fitness goal?</label>
                    <div class="card-group">
                        <div class="option-card" 
                             data-value="lose_weight" 
                             onclick="selectGoal('lose_weight')">
                            <div class="card-icon">üî•</div>
                            <div class="card-title">LOSE WEIGHT</div>
                            <div class="card-description">Burn fat while maintaining muscle<br>500 calorie deficit</div>
                        </div>
                        
                        <div class="option-card" 
                             data-value="maintain" 
                             onclick="selectGoal('maintain')">
                            <div class="card-icon">‚öñÔ∏è</div>
                            <div class="card-title">MAINTAIN WEIGHT</div>
                            <div class="card-description">Stay at current weight & strength<br>Maintenance calories</div>
                        </div>
                        
                        <div class="option-card" 
                             data-value="build_muscle" 
                             onclick="selectGoal('build_muscle')">
                            <div class="card-icon">üí™</div>
                            <div class="card-title">BUILD MUSCLE</div>
                            <div class="card-description">Gain lean mass with minimal fat<br>300 calorie surplus</div>
                        </div>
                    </div>
                    <input type="hidden" id="fitnessGoal" name="fitnessGoal" required>
                </div>

                <!-- Navigation -->
                <div class="wizard-nav">
                    <button type="button" 
                            class="btn-wizard btn-back" 
                            onclick="prevStep(2)">
                        ‚Üê Back
                    </button>
                    <button type="button" 
                            class="btn-wizard btn-next" 
                            onclick="nextStep(2)">
                        Next Step ‚Üí</button>
                </div>
            </div>

            <!-- STEP 3: Advanced Options -->
            <div class="wizard-step" data-step="3">
                <h2 class="wizard-title">Step 3 of 3: Advanced Options</h2>
                
                <!-- BMR Formula -->
                <div class="form-group">
                    <label>Choose calculation method:</label>
                    <div class="card-group">
                        <div class="option-card selected" 
                             data-value="mifflin" 
                             onclick="selectFormula('mifflin')">
                            <div class="card-icon">‚≠ê</div>
                            <div class="card-title">MIFFLIN-ST JEOR</div>
                            <div class="card-badge">Recommended</div>
                            <div class="card-description">Most accurate for general use</div>
                        </div>
                        
                        <div class="option-card" 
                             data-value="harris" 
                             onclick="selectFormula('harris')">
                            <div class="card-icon">üìä</div>
                            <div class="card-title">HARRIS-BENEDICT</div>
                            <div class="card-description">Classic formula, slightly higher</div>
                        </div>
                        
                        <div class="option-card" 
                             data-value="katch" 
                             onclick="selectFormula('katch')">
                            <div class="card-icon">üéØ</div>
                            <div class="card-title">KATCH-MCARDLE</div>
                            <div class="card-description">Best if you know body fat %</div>
                        </div>
                    </div>
                    <input type="hidden" id="bmrFormula" name="bmrFormula" value="mifflin-st-jeor">
                </div>

                <!-- Allergies (Existing Component) -->
                <div class="form-group">
                    <label>Do you have any food allergies?</label>
                    <div class="d-flex flex-wrap gap-4">
                        <div class="form-check" th:each="a : ${allergyOptions}">
                            <input class="form-check-input" type="checkbox" name="allergies" th:id="${'alg-'+a}" th:value="${a}"
                                   th:checked="${param.allergies != null and #lists.contains(param.allergies, a)}">
                            <label class="form-check-label" th:for="${'alg-'+a}" th:text="${a}"></label>
                        </div>
                    </div>
                    <div class="mt-3">
                        <label for="otherAllergies" class="form-label">Other (comma-separated)</label>
                        <textarea id="otherAllergies" name="otherAllergies" class="form-control" rows="2" placeholder="e.g., tomatoes, bell peppers, lactose" th:text="${param.otherAllergies}"></textarea>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="wizard-nav">
                    <button type="button" 
                            class="btn-wizard btn-back" 
                            onclick="prevStep(3)">
                        ‚Üê Back
                    </button>
                    <button type="submit" 
                            class="btn-wizard btn-submit">
                        Generate Plan üöÄ
                    </button>
                </div>
            </div>

        </form>
    </div>

    <script th:src="@{/webjars/bootstrap/js/bootstrap.bundle.min.js}"></script>
    <script th:src="@{/js/wizard.js}"></script>
</body>
</html>
